<section class="home-blog-preview" data-section-id="{{ section.id }}">
  <div class="home-blog-preview__inner">
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <header class="home-blog-preview__header">
        {% if section.settings.heading != blank %}
          <h2 class="home-blog-preview__heading">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="home-blog-preview__subheading">{{ section.settings.subheading }}</p>
        {% endif %}
      </header>
    {% endif %}

    {% assign selected_blog = section.settings.blog %}
    {% assign article_limit = section.settings.article_limit | default: 3 %}

    {% if selected_blog %}
      {% assign blog_articles = selected_blog.articles | slice: 0, article_limit %}
      {% if blog_articles.size > 0 %}
        <div class="home-blog-preview__grid">
          {% for article in blog_articles %}
            <article class="home-blog-preview__item">
              {% if article.image %}
                <a class="home-blog-preview__image-link" href="{{ article.url }}">
                  <img 
                    class="home-blog-preview__image" 
                    src="{{ article.image | image_url: "blank" }}" 
                    alt="{{ article.image.alt | default: article.title | escape }}"
                    width="{{ article.image.width }}"
                    height="{{ article.image.height }}"
                  />
                </a>
              {% endif %}

              <div class="home-blog-preview__content">
                <p class="home-blog-preview__meta">{{ article.published_at | date: "%b %d" }}</p>
                <h3 class="home-blog-preview__title">
                  <a href="{{ article.url }}">{{ article.title }}</a>
                </h3>
                <p class="home-blog-preview__excerpt">{{ article.excerpt_or_content | strip_html | truncate: 120 }}</p>
                <a class="home-blog-preview__cta" href="{{ article.url }}">Read story</a>
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <p class="home-blog-preview__empty">No recent stories found. Add posts to {{ selected_blog.title }}.</p>
      {% endif %}
    {% else %}
      <p class="home-blog-preview__empty">Select a blog to feature recent stories.</p>
    {% endif %}

    {% if section.settings.cta_label != blank and section.settings.cta_link != blank %}
      <div class="home-blog-preview__footer">
        <a class="home-blog-preview__button" href="{{ section.settings.cta_link }}">{{ section.settings.cta_label }}</a>
      </div>
    {% endif %}
  </div>
</section>

<style>
  .home-blog-preview {
    padding: 4rem 1.5rem 4.5rem;
    background-color: #fff;
  }

  .home-blog-preview__inner {
    max-width: 1100px;
    margin: 0 auto;
  }

  .home-blog-preview__header {
    text-align: center;
    margin-bottom: 2.5rem;
  }

  .home-blog-preview__heading {
    font-family: "Playfair Display", serif;
    font-size: clamp(2rem, 3vw, 2.8rem);
    margin: 0;
  }

  .home-blog-preview__subheading {
    max-width: 680px;
    margin: 0.75rem auto 0;
    color: #3c3c3c;
  }

  .home-blog-preview__grid {
    display: grid;
    gap: 1.75rem;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }

  .home-blog-preview__item {
    background: #FAF7F3;
    border-radius: 20px;
    overflow: hidden;
    display: grid;
    gap: 1.25rem;
  }

  .home-blog-preview__image-link {
    display: block;
  }

  .home-blog-preview__image {
    width: 100%;
    display: block;
    object-fit: cover;
  }

  .home-blog-preview__content {
    padding: 0 1.75rem 1.75rem;
  }

  .home-blog-preview__meta {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #7a7a7a;
    margin: 0 0 0.5rem;
  }

  .home-blog-preview__title {
    font-size: 1.35rem;
    margin: 0 0 0.75rem;
  }

  .home-blog-preview__title a {
    color: inherit;
    text-decoration: none;
  }

  .home-blog-preview__title a:hover {
    text-decoration: underline;
  }

  .home-blog-preview__excerpt {
    margin: 0 0 1.25rem;
    color: #3c3c3c;
  }

  .home-blog-preview__cta {
    font-weight: 600;
    color: #C27C57;
    text-decoration: none;
  }

  .home-blog-preview__cta:hover {
    text-decoration: underline;
  }

  .home-blog-preview__empty {
    text-align: center;
    color: #7a7a7a;
  }

  .home-blog-preview__footer {
    text-align: center;
    margin-top: 3rem;
  }

  .home-blog-preview__button {
    display: inline-block;
    padding: 0.9rem 2.4rem;
    border-radius: 999px;
    background: #E8C565;
    color: #1f2d1f;
    text-decoration: none;
    font-weight: 700;
  }

  .home-blog-preview__button:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
  }
</style>

{% schema %}
{
  "name": "Home blog preview",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Stories from the Hill Country Journal"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Peek behind each bouquet with tips, farmer highlights, and delivery moments across Central Texas."
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Blog"
    },
    {
      "type": "range",
      "id": "article_limit",
      "label": "Articles to show",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "text",
      "id": "cta_label",
      "label": "Button label",
      "default": "Visit our blog"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "Button link"
    }
  ],
  "presets": [
    {
      "name": "Blog preview",
      "category": "Custom"
    }
  ]
}
{% endschema %}
